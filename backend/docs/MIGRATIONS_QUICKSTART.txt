â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                           â•‘
â•‘              SQLx MIGRATIONS - QUICK START GUIDE                         â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸš€ EASIEST WAY - LET THE APP RUN MIGRATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Make sure PostgreSQL is running
2. Create database (if not exists):
   psql -U postgres -c "CREATE DATABASE football_heritage;"

3. Run the application:
   .\run.ps1

That's it! Migrations run automatically on startup! âœ¨


ğŸ“‹ WHAT GETS CREATED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ users              - User accounts (21+ age check)
âœ“ wallets            - Encrypted wallet balances
âœ“ transactions       - Transaction audit trail
âœ“ events             - Sports betting events
âœ“ bets               - User bets
âœ“ gambling_limits    - Responsible gambling limits
âœ“ user_activity      - Activity tracking
âœ“ betting_patterns   - Fraud detection

Plus:
âœ“ Indexes for performance
âœ“ Triggers for auto-updating timestamps
âœ“ 10 sample NFL events with realistic odds


ğŸ› ï¸ MANUAL METHOD - USING SQLx CLI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Install SQLx CLI:
  cargo install sqlx-cli --no-default-features --features postgres

Set database URL:
  set DATABASE_URL=postgresql://postgres:jumpman13@localhost:5432/football_heritage

Create database:
  sqlx database create

Run migrations:
  sqlx migrate run

Check status:
  sqlx migrate info


âš¡ QUICK SCRIPTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Option 1: PowerShell (Recommended)
  .\run_migrations.ps1

Option 2: Batch
  run_migrations.bat

Both scripts:
  âœ“ Check PostgreSQL connection
  âœ“ Create database if needed
  âœ“ Install SQLx CLI if needed
  âœ“ Run migrations
  âœ“ Verify tables created
  âœ“ Show sample data count


ğŸ“ MIGRATION FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Location: backend/migrations/

Current migration:
  20241019000001_initial_schema.sql

File naming format:
  {timestamp}_{description}.sql
  Example: 20241019120000_add_notifications.sql


ğŸ”§ SQLx COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create new migration:
  sqlx migrate add <description>
  Example: sqlx migrate add add_user_preferences

Run migrations:
  sqlx migrate run

Check migration status:
  sqlx migrate info

Revert last migration:
  sqlx migrate revert

Create database:
  sqlx database create

Drop database (careful!):
  sqlx database drop


âœ… VERIFY MIGRATIONS WORKED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List tables:
  psql -U postgres -d football_heritage -c "\dt"

Count events (should be 10):
  psql -U postgres -d football_heritage -c "SELECT COUNT(*) FROM events;"

Check migration history:
  psql -U postgres -d football_heritage -c "SELECT * FROM _sqlx_migrations;"


ğŸ” TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Error: "database does not exist"
  Solution: sqlx database create
  Or: psql -U postgres -c "CREATE DATABASE football_heritage;"

Error: "Failed to connect"
  Check:
  - PostgreSQL is running: sc query postgresql-x64-14
  - Credentials are correct in .env
  - Port 5432 is not blocked

Error: "migration already applied"
  This is normal! SQLx skips already-applied migrations.
  Check status: sqlx migrate info

Error: "syntax error in migration"
  Check the SQL file for errors:
  psql -U postgres -d football_heritage -f migrations/20241019000001_initial_schema.sql


ğŸ“š HOW IT WORKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

In main.rs, the application automatically runs:

  sqlx::migrate!("./migrations")
      .run(&db_pool)
      .await

This:
  1. Checks _sqlx_migrations table
  2. Runs any pending migrations
  3. Records applied migrations
  4. Continues app startup


ğŸ’¡ BEST PRACTICES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Never edit applied migrations (create new ones instead)
âœ“ Test migrations locally before production
âœ“ Keep migrations small and focused
âœ“ Use transactions (automatic in SQLx)
âœ“ Add descriptive migration names
âœ“ Commit migrations with code changes


ğŸ¯ CREATING NEW MIGRATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Create migration file:
   sqlx migrate add add_user_preferences

2. Edit the generated file:
   migrations/20241019120000_add_user_preferences.sql

3. Add your SQL:
   CREATE TABLE user_preferences (
       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
       user_id UUID NOT NULL REFERENCES users(id),
       theme VARCHAR(20) DEFAULT 'light',
       notifications_enabled BOOLEAN DEFAULT TRUE
   );

4. Run migration:
   sqlx migrate run
   Or just restart the app!


ğŸš€ PRODUCTION DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Option A: Automatic (on app startup)
  - Application runs migrations automatically
  - Simple but causes brief downtime

Option B: Manual (before deployment)
  - Run: sqlx migrate run (on production server)
  - Then deploy new application version
  - More control over timing


ğŸ“Š CURRENT STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Migration file created: migrations/20241019000001_initial_schema.sql
âœ“ Contains complete database schema
âœ“ Includes sample data (10 NFL events)
âœ“ Application configured to run migrations automatically

Ready to use! Just run: .\run.ps1


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    QUICK REFERENCE CARD

CREATE DATABASE:     sqlx database create
RUN MIGRATIONS:      sqlx migrate run
CHECK STATUS:        sqlx migrate info
NEW MIGRATION:       sqlx migrate add <name>
VERIFY TABLES:       psql -U postgres -d football_heritage -c "\dt"

OR JUST RUN:         .\run.ps1 (migrations run automatically!)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


For detailed documentation, see:
â€¢ SQLX_MIGRATIONS_GUIDE.md (704 lines - comprehensive)
â€¢ run_migrations.ps1 (automated PowerShell script)
â€¢ run_migrations.bat (automated batch script)


Last Updated: October 19, 2024
